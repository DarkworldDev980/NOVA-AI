<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NOVA AI - Ø§Ù„Ø´Ø§Øª</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body {
  margin:0;
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  background:radial-gradient(circle at top right, #1a1a2e, #050505);
  font-family:system-ui,sans-serif;
  color:#fff;
}

.card {
  width:100%;
  max-width:400px;
  background:rgba(20,20,20,.85);
  backdrop-filter:blur(20px);
  border-radius:26px;
  padding:30px;
  text-align:left;
  box-shadow:0 25px 50px rgba(0,0,0,.5);
}

#messages {
  height:300px;
  overflow-y:auto;
  margin-bottom:10px;
  border:1px solid rgba(255,255,255,.1);
  border-radius:14px;
  padding:10px;
  background:rgba(0,0,0,.2);
}

#messages div {margin-bottom:8px;}
textarea {
  width:100%;
  padding:14px;
  margin-bottom:12px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.1);
  background:rgba(255,255,255,.05);
  color:#fff;
  font-size:1rem;
  resize:none;
}
input[type=file] {margin-bottom:10px;}
button {
  width:100%;
  padding:14px;
  border-radius:14px;
  border:none;
  font-size:1rem;
  font-weight:600;
  cursor:pointer;
  margin-top:5px;
}
.main {background:#4285F4;color:#fff;}
</style>
</head>
<body>

<div class="card">
  <h1>Ù…Ø±Ø­Ø¨Ø§Ù‹ ðŸ‘‹</h1>
  <div id="messages"></div>
  <textarea id="user-input" placeholder="Ø£ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..."></textarea>
  <input type="file" id="file-input">
  <button class="main" id="send-btn">Ø¥Ø±Ø³Ø§Ù„</button>
  <button class="main" id="logout-btn">Ø®Ø±ÙˆØ¬</button>
</div>

<script>
const SUPABASE_URL = "https://wmkkqnuvzsazurswdjdr.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indta2txbnV2enNhenVyc3dkamRyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk0Mzc4MzAsImV4cCI6MjA4NTAxMzgzMH0.PRVzT4kIOiWftiQN8uZt2OFgeX-jJg56xO7xHfzqCss";
const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

// Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø´Ø§Øª
const messages = document.getElementById('messages');
const userInput = document.getElementById('user-input');
const fileInput = document.getElementById('file-input');
const sendBtn = document.getElementById('send-btn');
const logoutBtn = document.getElementById('logout-btn');

// âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¬Ù„Ø³Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
(async () => {
  const { data: { session } } = await supabaseClient.auth.getSession();
  if(!session) window.location.href = "index.html"; // Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ¬ÙŠÙ‡ Ø¥Ø°Ø§ Ù„Ù… ÙŠØ³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„
})();

// Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ÙˆØ§Ù„Ù…Ù„ÙØ§Øª
sendBtn.onclick = async () => {
  const text = userInput.value.trim();
  if(!text && fileInput.files.length===0) return;

  if(text) messages.innerHTML += `<div><b>Ø£Ù†Øª:</b> ${text}</div>`;

  const formData = new FormData();
  if(text) formData.append('message', text);
  if(fileInput.files.length>0) formData.append('file', fileInput.files[0]);

  try {
    const res = await fetch('https://wmkkqnuvzsazurswdjdr.supabase.co/functions/v1/clever-handler', {
      method: 'POST',
      body: formData
    });
    const data = await res.json();
    messages.innerHTML += `<div><b>NOVA AI:</b> ${data.response}</div>`;
    messages.scrollTop = messages.scrollHeight;
  } catch(e){
    messages.innerHTML += `<div><b>Ø®Ø·Ø£:</b> Ù„Ù… ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©</div>`;
  }

  userInput.value = '';
  fileInput.value = '';
};

// Ø²Ø± Ø§Ù„Ø®Ø±ÙˆØ¬
logoutBtn.onclick = async () => {
  await supabaseClient.auth.signOut();
  window.location.href = "index.html";
};
</script>

</body>
</html>